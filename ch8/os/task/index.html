<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Implementation of process `ProcessControlBlock` and task(thread) `TaskControlBlock` management mechanism"><title>os::task - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-deb46770fd761b69.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="os" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (249624b50 2023-10-20)" data-channel="nightly" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-5f34af1a0ee6bacd.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../os/index.html">os</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module task</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate os</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press â€˜Sâ€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">os</a>::<wbr><a class="mod" href="#">task</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/os/task/mod.rs.html#1-206">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Implementation of process <a href="process/struct.ProcessControlBlock.html" title="struct os::task::process::ProcessControlBlock"><code>ProcessControlBlock</code></a> and task(thread) <a href="task/struct.TaskControlBlock.html" title="struct os::task::task::TaskControlBlock"><code>TaskControlBlock</code></a> management mechanism</p>
<p>Here is the entry for task scheduling required by other modules
(such as syscall or clock interrupt).
By suspending or exiting the current task, you can
modify the task state, manage the task queue through TASK_MANAGER (in task/manager.rs) ,
and switch the control flow through PROCESSOR (in task/processor.rs) .</p>
<p>Be careful when you see <a href="switch/fn.__switch.html" title="fn os::task::switch::__switch"><code>__switch</code></a>. Control flow around this function
might not be what you expect.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="context/index.html" title="mod os::task::context">context</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Implementation of <a href="context/struct.TaskContext.html" title="struct os::task::context::TaskContext"><code>TaskContext</code></a></div></li><li><div class="item-name"><a class="mod" href="id/index.html" title="mod os::task::id">id</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Allocator for pid, task user resource, kernel stack using a simple recycle strategy.</div></li><li><div class="item-name"><a class="mod" href="manager/index.html" title="mod os::task::manager">manager</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Implementation of <a href="manager/struct.TaskManager.html" title="struct os::task::manager::TaskManager"><code>TaskManager</code></a></div></li><li><div class="item-name"><a class="mod" href="process/index.html" title="mod os::task::process">process</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Implementation of  <a href="process/struct.ProcessControlBlock.html" title="struct os::task::process::ProcessControlBlock"><code>ProcessControlBlock</code></a></div></li><li><div class="item-name"><a class="mod" href="processor/index.html" title="mod os::task::processor">processor</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Implementation of <a href="processor/struct.Processor.html" title="struct os::task::processor::Processor"><code>Processor</code></a> and Intersection of control flow</div></li><li><div class="item-name"><a class="mod" href="signal/index.html" title="mod os::task::signal">signal</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Signal flags and function for convert signal flag to integer &amp; string</div></li><li><div class="item-name"><a class="mod" href="switch/index.html" title="mod os::task::switch">switch</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">provides __switch asm function to switch between two task contexts  <a href="context/struct.TaskContext.html" title="struct os::task::context::TaskContext"><code>TaskContext</code></a></div></li><li><div class="item-name"><a class="mod" href="task/index.html" title="mod os::task::task">task</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Types related to task management &amp; Functions for completely changing TCB</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.INITPROC.html" title="struct os::task::INITPROC">INITPROC</a></div><div class="desc docblock-short">Creation of initial process</div></li><li><div class="item-name"><a class="struct" href="struct.KernelStack.html" title="struct os::task::KernelStack">KernelStack</a></div><div class="desc docblock-short">Kernel stack for a task</div></li><li><div class="item-name"><a class="struct" href="struct.PidHandle.html" title="struct os::task::PidHandle">PidHandle</a></div><div class="desc docblock-short">A handle to a pid</div></li><li><div class="item-name"><a class="struct" href="struct.SignalFlags.html" title="struct os::task::SignalFlags">SignalFlags</a></div><div class="desc docblock-short">Signal flags</div></li><li><div class="item-name"><a class="struct" href="struct.TaskContext.html" title="struct os::task::TaskContext">TaskContext</a></div><div class="desc docblock-short">task context structure containing some registers</div></li><li><div class="item-name"><a class="struct" href="struct.TaskControlBlock.html" title="struct os::task::TaskControlBlock">TaskControlBlock</a></div><div class="desc docblock-short">Task control block structure</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.TaskStatus.html" title="enum os::task::TaskStatus">TaskStatus</a></div><div class="desc docblock-short">The execution status of the current process</div></li></ul><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.IDLE_PID.html" title="constant os::task::IDLE_PID">IDLE_PID</a></div><div class="desc docblock-short">The idle taskâ€™s pid is 0</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.add_initproc.html" title="fn os::task::add_initproc">add_initproc</a></div><div class="desc docblock-short">Add init process to the manager</div></li><li><div class="item-name"><a class="fn" href="fn.add_task.html" title="fn os::task::add_task">add_task</a></div><div class="desc docblock-short">Add a task to ready queue</div></li><li><div class="item-name"><a class="fn" href="fn.block_current_and_run_next.html" title="fn os::task::block_current_and_run_next">block_current_and_run_next</a></div><div class="desc docblock-short">Make current task blocked and switch to the next task.</div></li><li><div class="item-name"><a class="fn" href="fn.check_signals_of_current.html" title="fn os::task::check_signals_of_current">check_signals_of_current</a></div><div class="desc docblock-short">Check if the current task has any signal to handle</div></li><li><div class="item-name"><a class="fn" href="fn.current_add_signal.html" title="fn os::task::current_add_signal">current_add_signal</a></div><div class="desc docblock-short">Add signal to the current task</div></li><li><div class="item-name"><a class="fn" href="fn.current_kstack_top.html" title="fn os::task::current_kstack_top">current_kstack_top</a></div><div class="desc docblock-short">get the top addr of kernel stack</div></li><li><div class="item-name"><a class="fn" href="fn.current_process.html" title="fn os::task::current_process">current_process</a></div><div class="desc docblock-short">get current process</div></li><li><div class="item-name"><a class="fn" href="fn.current_task.html" title="fn os::task::current_task">current_task</a></div><div class="desc docblock-short">Get a copy of the current task</div></li><li><div class="item-name"><a class="fn" href="fn.current_trap_cx.html" title="fn os::task::current_trap_cx">current_trap_cx</a></div><div class="desc docblock-short">Get the mutable reference to trap context of current task</div></li><li><div class="item-name"><a class="fn" href="fn.current_trap_cx_user_va.html" title="fn os::task::current_trap_cx_user_va">current_trap_cx_user_va</a></div><div class="desc docblock-short">get the user virtual address of trap context</div></li><li><div class="item-name"><a class="fn" href="fn.current_user_token.html" title="fn os::task::current_user_token">current_user_token</a></div><div class="desc docblock-short">Get the current user token(addr of page table)</div></li><li><div class="item-name"><a class="fn" href="fn.exit_current_and_run_next.html" title="fn os::task::exit_current_and_run_next">exit_current_and_run_next</a></div><div class="desc docblock-short">Exit the current â€˜Runningâ€™ task and run the next task in task list.</div></li><li><div class="item-name"><a class="fn" href="fn.kstack_alloc.html" title="fn os::task::kstack_alloc">kstack_alloc</a></div><div class="desc docblock-short">Allocate a kernel stack for a task</div></li><li><div class="item-name"><a class="fn" href="fn.pid2process.html" title="fn os::task::pid2process">pid2process</a></div><div class="desc docblock-short">Get process by pid</div></li><li><div class="item-name"><a class="fn" href="fn.pid_alloc.html" title="fn os::task::pid_alloc">pid_alloc</a></div><div class="desc docblock-short">Allocate a pid for a process</div></li><li><div class="item-name"><a class="fn" href="fn.remove_from_pid2process.html" title="fn os::task::remove_from_pid2process">remove_from_pid2process</a></div><div class="desc docblock-short">Remove item(pid, _some_pcb) from PDI2PCB map (called by exit_current_and_run_next)</div></li><li><div class="item-name"><a class="fn" href="fn.remove_inactive_task.html" title="fn os::task::remove_inactive_task">remove_inactive_task</a></div><div class="desc docblock-short">the inactive(blocked) tasks are removed when the PCB is deallocated.(called by exit_current_and_run_next)</div></li><li><div class="item-name"><a class="fn" href="fn.remove_task.html" title="fn os::task::remove_task">remove_task</a></div><div class="desc docblock-short">Remove a task from the ready queue</div></li><li><div class="item-name"><a class="fn" href="fn.run_tasks.html" title="fn os::task::run_tasks">run_tasks</a></div><div class="desc docblock-short">The main part of process execution and scheduling
Loop <code>fetch_task</code> to get the process that needs to run, and switch the process through <code>__switch</code></div></li><li><div class="item-name"><a class="fn" href="fn.schedule.html" title="fn os::task::schedule">schedule</a></div><div class="desc docblock-short">Return to idle control flow for new scheduling</div></li><li><div class="item-name"><a class="fn" href="fn.suspend_current_and_run_next.html" title="fn os::task::suspend_current_and_run_next">suspend_current_and_run_next</a></div><div class="desc docblock-short">Make current task suspended and switch to the next task</div></li><li><div class="item-name"><a class="fn" href="fn.take_current_task.html" title="fn os::task::take_current_task">take_current_task</a></div><div class="desc docblock-short">Get current task through take, leaving a None in its place</div></li><li><div class="item-name"><a class="fn" href="fn.wakeup_task.html" title="fn os::task::wakeup_task">wakeup_task</a></div><div class="desc docblock-short">Wake up a task</div></li></ul></section></div></main></body></html>